{
  "$schema": "./schemas/maintenance-schedule.schema.json",
  "version": "1.0.0",
  "description": "定期维护计划配置 - 自动化 dotfiles 项目健康检查和维护",
  "schedules": {
    "daily": {
      "name": "每日快速检查",
      "description": "轻量级日常健康检查，确保基本功能正常",
      "enabled": true,
      "time": "08:00",
      "level": "Basic",
      "tasks": [
        "validate-json",
        "quick-health-check",
        "cleanup-temp-files"
      ],
      "notifications": {
        "onFailure": true,
        "onSuccess": false,
        "methods": ["console"]
      }
    },
    "weekly": {
      "name": "每周标准维护",
      "description": "全面的项目维护，包括测试验证和清理操作",
      "enabled": true,
      "dayOfWeek": "Sunday",
      "time": "02:00",
      "level": "Standard",
      "tasks": [
        "validate-json",
        "run-all-tests",
        "health-check-detailed",
        "cleanup-temp-files",
        "cleanup-backup-files",
        "git-status-check",
        "performance-check"
      ],
      "notifications": {
        "onFailure": true,
        "onSuccess": true,
        "methods": ["console", "log"]
      },
      "generateReport": true
    },
    "monthly": {
      "name": "每月深度维护",
      "description": "完整的系统优化和包更新，确保最佳性能",
      "enabled": false,
      "dayOfMonth": 1,
      "time": "01:00",
      "level": "Deep",
      "tasks": [
        "validate-json",
        "run-all-tests",
        "health-check-detailed",
        "cleanup-temp-files",
        "cleanup-backup-files",
        "update-packages",
        "git-optimization",
        "performance-analysis",
        "integrity-check"
      ],
      "notifications": {
        "onFailure": true,
        "onSuccess": true,
        "methods": ["console", "log", "email"]
      },
      "generateReport": true,
      "createBackup": true
    }
  },
  "tasks": {
    "validate-json": {
      "name": "JSON 配置验证",
      "description": "验证所有 JSON 配置文件语法正确性",
      "script": "scripts/Validate-JsonConfigs.ps1",
      "timeout": 30,
      "retryCount": 1,
      "critical": true
    },
    "quick-health-check": {
      "name": "快速健康检查",
      "description": "基础系统状态检查",
      "script": "health-check.ps1",
      "parameters": [],
      "timeout": 60,
      "retryCount": 2,
      "critical": true
    },
    "health-check-detailed": {
      "name": "详细健康检查",
      "description": "完整的系统健康状态分析",
      "script": "health-check.ps1",
      "parameters": ["-Detailed"],
      "timeout": 120,
      "retryCount": 2,
      "critical": true
    },
    "run-all-tests": {
      "name": "运行所有测试",
      "description": "执行完整的测试套件验证",
      "script": "scripts/Run-AllTests.ps1",
      "timeout": 300,
      "retryCount": 1,
      "critical": true
    },
    "cleanup-temp-files": {
      "name": "清理临时文件",
      "description": "删除临时文件和日志",
      "patterns": [
        "*.tmp",
        "*.temp",
        "*.log",
        "*.bak",
        "*~",
        "TestResults.xml"
      ],
      "timeout": 60,
      "critical": false
    },
    "cleanup-backup-files": {
      "name": "清理备份文件",
      "description": "删除过期的备份文件",
      "patterns": [
        "*.backup",
        "*.old",
        "*_backup",
        "*-backup*"
      ],
      "olderThanDays": 30,
      "timeout": 60,
      "critical": false
    },
    "update-packages": {
      "name": "更新软件包",
      "description": "更新 Scoop 包和 PowerShell 模块",
      "script": "install_apps.ps1",
      "parameters": ["-Update"],
      "timeout": 900,
      "retryCount": 1,
      "critical": false
    },
    "git-status-check": {
      "name": "Git 状态检查",
      "description": "检查 Git 仓库状态和未提交更改",
      "commands": [
        "git status --porcelain",
        "git fetch --dry-run",
        "git rev-list --count HEAD ^origin/main"
      ],
      "timeout": 60,
      "critical": false
    },
    "git-optimization": {
      "name": "Git 仓库优化",
      "description": "执行 Git 垃圾收集和优化",
      "commands": [
        "git gc --aggressive --prune=now",
        "git remote prune origin"
      ],
      "timeout": 300,
      "critical": false
    },
    "performance-check": {
      "name": "性能检查",
      "description": "分析 PowerShell 配置加载性能",
      "timeout": 120,
      "critical": false,
      "thresholds": {
        "profileLoadTime": 2.0,
        "healthCheckTime": 10.0
      }
    },
    "performance-analysis": {
      "name": "性能深度分析",
      "description": "完整的系统性能分析和优化建议",
      "timeout": 300,
      "critical": false
    },
    "integrity-check": {
      "name": "完整性检查",
      "description": "验证项目结构和关键文件完整性",
      "requiredFiles": [
        "README.md",
        "install.ps1",
        "health-check.ps1",
        "config/install.json",
        "modules/DotfilesUtilities.psm1"
      ],
      "timeout": 60,
      "critical": true
    }
  },
  "settings": {
    "executionPolicy": {
      "requireAdminRights": false,
      "allowParallelExecution": false,
      "maxConcurrentTasks": 1
    },
    "logging": {
      "enabled": true,
      "level": "INFO",
      "directory": "logs",
      "filename": "maintenance-{date}.log",
      "maxLogFiles": 30,
      "maxLogSizeKB": 1024
    },
    "notifications": {
      "console": {
        "enabled": true,
        "verboseOutput": false,
        "useColors": true
      },
      "log": {
        "enabled": true,
        "includeTimestamp": true,
        "includeLevel": true
      },
      "email": {
        "enabled": false,
        "smtpServer": "",
        "port": 587,
        "useSsl": true,
        "fromAddress": "",
        "toAddresses": [],
        "subject": "Dotfiles 维护报告 - {date}"
      }
    },
    "backup": {
      "enabled": true,
      "directory": ".maintenance-backups",
      "keepVersions": 5,
      "compressOld": true,
      "beforeDeepMaintenance": true
    },
    "reporting": {
      "enabled": true,
      "format": "json",
      "directory": "reports",
      "filename": "maintenance-report-{timestamp}.json",
      "includeStatistics": true,
      "includeTaskDetails": true,
      "maxReports": 50
    },
    "safety": {
      "dryRunFirst": false,
      "confirmDangerousOperations": true,
      "backupBeforeCriticalTasks": true,
      "stopOnFirstCriticalFailure": true
    }
  },
  "profiles": {
    "minimal": {
      "description": "最小维护配置，仅基本检查",
      "schedules": ["daily"],
      "tasks": [
        "validate-json",
        "quick-health-check"
      ]
    },
    "standard": {
      "description": "标准维护配置，平衡性能和完整性",
      "schedules": ["daily", "weekly"],
      "tasks": [
        "validate-json",
        "quick-health-check",
        "run-all-tests",
        "cleanup-temp-files",
        "git-status-check"
      ]
    },
    "comprehensive": {
      "description": "全面维护配置，包含所有功能",
      "schedules": ["daily", "weekly", "monthly"],
      "tasks": "all",
      "notifications": {
        "methods": ["console", "log"],
        "verboseOutput": true
      }
    },
    "developer": {
      "description": "开发者配置，频繁检查和测试",
      "schedules": [
        {
          "name": "dev-check",
          "time": "*/2",
          "level": "Basic",
          "tasks": ["validate-json", "quick-health-check"]
        }
      ],
      "notifications": {
        "onFailure": true,
        "methods": ["console"]
      }
    }
  },
  "metadata": {
    "lastModified": "2025-01-07T15:30:00Z",
    "configVersion": "1.0.0",
    "compatibleVersions": ["1.x"],
    "author": "Dotfiles Maintenance System",
    "description": "定期维护任务的配置和调度设置，确保 dotfiles 项目持续健康运行"
  }
}
