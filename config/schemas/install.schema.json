{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://dotfiles.local/schemas/install.schema.json",
  "title": "Dotfiles Install Configuration Schema",
  "description": "Schema for validating dotfiles installation configuration",
  "type": "object",
  "required": ["version", "defaultMode", "components"],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Configuration version following semantic versioning"
    },
    "defaultMode": {
      "type": "string",
      "enum": ["copy", "symlink"],
      "description": "Default installation mode for components"
    },
    "environment": {
      "type": "object",
      "properties": {
        "requireElevation": {
          "type": "boolean",
          "description": "Whether installation requires elevated privileges"
        },
        "checkPrerequisites": {
          "type": "boolean",
          "description": "Whether to check prerequisites before installation"
        },
        "createBackups": {
          "type": "boolean",
          "description": "Whether to create backups of existing configurations"
        },
        "validateAfterInstall": {
          "type": "boolean",
          "description": "Whether to validate installation after completion"
        }
      },
      "additionalProperties": false
    },
    "components": {
      "type": "object",
      "patternProperties": {
        "^[a-zA-Z_][a-zA-Z0-9_]*$": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z_][a-zA-Z0-9_]*$": {
              "$ref": "#/definitions/component"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "settings": {
      "type": "object",
      "properties": {
        "backup": {
          "$ref": "#/definitions/backupSettings"
        },
        "logging": {
          "$ref": "#/definitions/loggingSettings"
        },
        "validation": {
          "$ref": "#/definitions/validationSettings"
        },
        "rollback": {
          "$ref": "#/definitions/rollbackSettings"
        },
        "ui": {
          "$ref": "#/definitions/uiSettings"
        }
      },
      "additionalProperties": false
    },
    "profiles": {
      "type": "object",
      "patternProperties": {
        "^[a-zA-Z_][a-zA-Z0-9_]*$": {
          "$ref": "#/definitions/profile"
        }
      },
      "additionalProperties": false
    },
    "presets": {
      "type": "object",
      "patternProperties": {
        "^[a-zA-Z_][a-zA-Z0-9_]*$": {
          "$ref": "#/definitions/preset"
        }
      },
      "additionalProperties": false
    },
    "metadata": {
      "$ref": "#/definitions/metadata"
    }
  },
  "additionalProperties": false,
  "definitions": {
    "component": {
      "type": "object",
      "required": ["enabled", "priority", "description"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether this component is enabled by default"
        },
        "priority": {
          "type": "integer",
          "minimum": 1,
          "description": "Installation priority (lower numbers install first)"
        },
        "description": {
          "type": "string",
          "minLength": 1,
          "description": "Human-readable description of the component"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$"
          },
          "uniqueItems": true,
          "description": "List of component dependencies that must be installed first"
        },
        "paths": {
          "type": "object",
          "required": ["source", "target"],
          "properties": {
            "source": {
              "type": "string",
              "minLength": 1,
              "description": "Source path relative to project root"
            },
            "target": {
              "type": "string",
              "minLength": 1,
              "description": "Target path with environment variable support"
            }
          },
          "additionalProperties": false
        },
        "installMode": {
          "type": "string",
          "enum": ["copy", "symlink"],
          "description": "Installation mode for this component"
        },
        "backupExisting": {
          "type": "boolean",
          "description": "Whether to backup existing files before installation"
        },
        "validateCommand": {
          "type": "string",
          "description": "Command to run for validating the installation"
        },
        "optional": {
          "type": "boolean",
          "description": "Whether this component is optional and can be skipped"
        },
        "createTargetDir": {
          "type": "boolean",
          "description": "Whether to create the target directory if it doesn't exist"
        },
        "filePatterns": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "File patterns to include/exclude during installation"
        },
        "preInstall": {
          "type": "string",
          "description": "PowerShell script to run before installing this component"
        },
        "postInstall": {
          "type": "string",
          "description": "PowerShell script to run after installing this component"
        }
      },
      "additionalProperties": false
    },
    "backupSettings": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "directory": {
          "type": "string",
          "minLength": 1
        },
        "keepVersions": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100
        },
        "compressOld": {
          "type": "boolean"
        },
        "timestampFormat": {
          "type": "string",
          "minLength": 1
        }
      },
      "additionalProperties": false
    },
    "loggingSettings": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "level": {
          "type": "string",
          "enum": ["DEBUG", "INFO", "WARN", "ERROR"]
        },
        "file": {
          "type": "string",
          "minLength": 1
        },
        "maxSize": {
          "type": "string",
          "pattern": "^\\d+[KMGT]?B$"
        },
        "rotateCount": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100
        }
      },
      "additionalProperties": false
    },
    "validationSettings": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "strictMode": {
          "type": "boolean"
        },
        "timeoutSeconds": {
          "type": "integer",
          "minimum": 1,
          "maximum": 300
        },
        "retryCount": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10
        }
      },
      "additionalProperties": false
    },
    "rollbackSettings": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "autoRollbackOnFailure": {
          "type": "boolean"
        },
        "confirmBeforeRollback": {
          "type": "boolean"
        }
      },
      "additionalProperties": false
    },
    "uiSettings": {
      "type": "object",
      "properties": {
        "interactive": {
          "type": "boolean"
        },
        "showProgress": {
          "type": "boolean"
        },
        "useColors": {
          "type": "boolean"
        },
        "confirmOverwrite": {
          "type": "boolean"
        },
        "verboseOutput": {
          "type": "boolean"
        }
      },
      "additionalProperties": false
    },
    "profile": {
      "type": "object",
      "required": ["description", "components"],
      "properties": {
        "description": {
          "type": "string",
          "minLength": 1
        },
        "components": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$"
          },
          "uniqueItems": true,
          "minItems": 1
        },
        "settings": {
          "type": "object",
          "properties": {
            "defaultMode": {
              "type": "string",
              "enum": ["copy", "symlink"]
            },
            "validation": {
              "$ref": "#/definitions/validationSettings"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "preset": {
      "type": "object",
      "required": ["description"],
      "properties": {
        "description": {
          "type": "string",
          "minLength": 1
        },
        "overrides": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    },
    "metadata": {
      "type": "object",
      "properties": {
        "lastModified": {
          "type": "string",
          "format": "date-time"
        },
        "configVersion": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "compatibleVersions": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "author": {
          "type": "string"
        },
        "description": {
          "type": "string"
        }
      },
      "additionalProperties": false
    }
  }
}
